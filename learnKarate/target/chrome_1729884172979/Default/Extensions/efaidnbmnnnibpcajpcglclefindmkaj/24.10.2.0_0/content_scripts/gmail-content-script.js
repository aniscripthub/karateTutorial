/*************************************************************************
* ADOBE CONFIDENTIAL
* ___________________
*
*  Copyright 2015 Adobe Systems Incorporated
*  All Rights Reserved.
*
* NOTICE:  All information contained herein is, and remains
* the property of Adobe Systems Incorporated and its suppliers,
* if any.  The intellectual and technical concepts contained
* herein are proprietary to Adobe Systems Incorporated and its
* suppliers and are protected by all applicable intellectual property laws,
* including trade secret and or copyright laws.
* Dissemination of this information or reproduction of this material
* is strictly forbidden unless prior written permission is obtained
* from Adobe Systems Incorporated.
**************************************************************************/
(()=>{const e="acrobatContentScriptDisconnectStart",t="acrobatContentScriptDisconnectEnd",n="acrobat-icon-added",o="acrobat-listener-added",i="acrobat-gmail-fte-config";let r,c,a,s,l;const m=()=>{a?.addAcrobatTouchPointInTheMessageView(),s?.processForListView(),c?.processForAlreadyShownNativeViewerPrompt()},d=new MutationObserver((function(){l?.disconnectBodyObserver?d.disconnect():(d.takeRecords(),chrome?.runtime?.id?m():(g(),d?.disconnect()))})),u=()=>{if(l?.adobeCleanFontAdded)return;const e=chrome.runtime.getURL("browser/css/fonts/AdobeClean-Regular.otf"),t=new FontFace("AdobeClean-Regular",`url(${e})`);t.load().then((()=>{document.fonts.add(t)})),l.adobeCleanFontAdded=!0},g=()=>{if(a?.removeAllTouchPoints(),s?.removeAllTouchPoints(),c?.removeAllTouchPoints(),document.querySelector(`img[${n}]`)){const e=document.querySelectorAll(`img[${n}]`);for(let t=0;t<e.length;t++)e[t]?.removeAttribute(n)}if(document.querySelector(`[${o}]`)){const e=document.querySelectorAll(`[${o}="Y"]`);for(let t=0;t<e.length;t++)e[t]?.setAttribute(o,"N")}},h=n=>{window.addEventListener(t,(e=>n.contentScriptDisconnectEnd(e)),{signal:n?.eventControllerSignal}),window.dispatchEvent(new Event("orphanContentScript")),window.dispatchEvent(new CustomEvent(e)),window.addEventListener(e,(()=>(e=>{if(!chrome.runtime?.id){const n=e.createStateToTransferToNewContentScript();e.contentScriptDisconnectStart(),d?.disconnect(),window.dispatchEvent(new CustomEvent(t,{detail:{state:n}}))}})(n)),{signal:n?.eventControllerSignal}),u()},p=async e=>{const t=chrome.runtime.getURL("content_scripts/gmail/state.js");l=(await import(t)).default,(e=>{l&&(l.gmailConfig=e,l.iconURL=chrome.runtime.getURL("browser/images/acrobat_dc_appicon_128.png"),l.iconURLListView=chrome.runtime.getURL("browser/images/acrobat_dc_trefoil_24_white.svg"),l.viewerURLPrefix=chrome.runtime.getURL("viewer.html"))})(e),h(l);const n=chrome.runtime.getURL("content_scripts/gmail/gmail-response-service.js"),o=chrome.runtime.getURL("content_scripts/gmail/native-viewer-touch-point-service.js"),i=chrome.runtime.getURL("content_scripts/gmail/message-view-touch-point-service.js"),m=chrome.runtime.getURL("content_scripts/gmail/list-view-touch-point-service.js");return Promise.all([import(n),import(o),import(i),import(m)]).then((e=>{r=e[0],c=e[1],a=e[2],s=e[3]}))},w=e=>{try{chrome.runtime.sendMessage({main_op:"analytics",analytics:e})}catch(e){}};chrome.runtime.onMessage.addListener((function(e){"acrobatGsuiteTouchPointsDisabled"===e.content_op&&(d?.disconnect(),g(),l?.disconnectEventListeners())})),chrome.runtime.onMessage.addListener((function(e){"acrobatGmailFteStateUpdated"===e.content_op&&(l.fteToolTip={...l.fteToolTip,...e?.fteState})})),window.location?.search?.includes("acrobatPromotionSource")||chrome.runtime?.sendMessage({main_op:"gmail-init"},(e=>{e.touchPointSettingEnabled&&(e.enableAttachmentCardPromptInGmail||window.location?.search?.includes("enableAcrobatPromptInGmail"))&&p(e).then((()=>{(async e=>{const t=(new Date).getTime();let n={count:0,nextDate:t};n=(await chrome.storage.local.get(i))?.[i]||n;const o=l?.gmailConfig?.fteConfig?.tooltip;((e,t)=>-1!==e?.resetDay&&t>e?.resetDay)(o,t)&&(n.count=0,n.nextDate=t),l.fteToolTip={eligibleFte:{type:""},...n},n={[i]:n},chrome.storage.local.set(n)})(),g(),m(),(()=>{try{const e={childList:!0,subtree:!0};d.observe(document.body,e)}catch(e){}})(),w([["DCBrowserExt:Gmail:PromotionFeature:Enable"]]),e?.enableGmailFteToolTip&&w([["DCBrowserExt:Gmail:FTE:Enable"]])}))}))})();